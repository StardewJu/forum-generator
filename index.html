<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>è®ºå›ä½“ç”Ÿæˆå™¨ (åŠ å¼ºç‰ˆ)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        .preview-area { background-color: #FDF9EE; }
        .post-card { border-bottom: 1px solid #E2DCC8; }
        /* é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ“ä½œæŒ‰é’® */
        .post-card:hover .action-buttons { opacity: 1; }
        .action-buttons { opacity: 0; transition: opacity 0.2s; }
    </style>
</head>
<body class="bg-gray-100 h-screen p-5">

    <div id="app" class="flex gap-5 h-full">
        
        <div class="w-1/3 bg-white p-5 rounded shadow flex flex-col gap-4 overflow-auto">
            <h2 class="text-xl font-bold">ç¼–è¾‘æ§åˆ¶å°</h2>
            
            <div class="space-y-2 mb-2 border-b pb-4">
                <label class="block text-sm font-bold text-gray-700">é¡¶éƒ¨å¯¼èˆªè®¾ç½®</label>
                <div class="flex gap-2">
                    <input v-model="forumName" class="w-1/2 border p-1 rounded text-sm" placeholder="è®ºå›å">
                    <input v-model="subForum" class="w-1/2 border p-1 rounded text-sm" placeholder="æ¿å—å">
                </div>
                <input v-model="threadTitle" class="w-full border p-1 rounded text-sm font-bold" placeholder="å¸–å­æ ‡é¢˜">
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ­ å¿«é€Ÿé€‰æ‹©è§’è‰²</label>
                <select v-model="selectedPreset" @change="applyPreset" class="w-full border p-2 rounded text-sm bg-white">
                    <option value="" disabled>-- è¯·é€‰æ‹©é¢„è®¾è§’è‰² --</option>
                    <option v-for="role in presets" :value="role.name">
                        {{ role.name }} ({{ role.id }})
                    </option>
                </select>

                <div class="mt-2 p-2 bg-gray-50 border border-dashed rounded text-sm">
                    <div class="flex gap-2 mb-2">
                        <input v-model="newPresetName" placeholder="å¤‡æ³¨(å¦‚:åæ´¾)" class="w-1/2 border p-1 rounded text-xs">
                        <input v-model="newPresetId" placeholder="ID(å¦‚:æ€æ‰‹)" class="w-1/2 border p-1 rounded text-xs">
                    </div>
                    <button @click="addCustomPreset" class="w-full bg-gray-600 text-white py-1 rounded hover:bg-gray-700 text-xs">
                        ä¿å­˜åˆ°ä¸‹æ‹‰æ¡†
                    </button>
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold">å½“å‰èº«ä»½</label>
                <div class="flex gap-2 mt-1 mb-2">
                    <button @click="currentRole = 'LZ'" :class="{'bg-blue-500 text-white': currentRole==='LZ'}" class="px-3 py-1 border rounded text-sm">æ¥¼ä¸»</button>
                    <button @click="currentRole = 'è·¯äºº'" :class="{'bg-green-500 text-white': currentRole==='è·¯äºº'}" class="px-3 py-1 border rounded text-sm">è·¯äºº</button>
                </div>
                <input v-model="currentId" class="w-full border p-2 rounded" type="text" placeholder="ç”¨æˆ·ID">
            </div>

            <div>
                <div class="flex justify-between items-center mb-1">
                    <label class="block text-sm font-bold">å›å¤å†…å®¹</label>
                    <span v-if="insertIndex !== -1" class="text-xs font-bold text-purple-600 bg-purple-100 px-2 py-1 rounded">
                        æ­£åœ¨ï¼š{{ insertIndex }}L åæ’å…¥
                        <button @click="cancelInsert" class="ml-1 text-red-500 underline">å–æ¶ˆ</button>
                    </span>
                </div>
                
                <textarea v-model="content" class="w-full border p-2 rounded h-24" placeholder="è¾“å…¥å†…å®¹..."></textarea>
            <div class="mt-2 mb-2">
    <label class="block text-sm font-bold mb-1">æ’å…¥å›¾ç‰‡ (å¯é€‰)</label>
    <div class="flex gap-2 items-center">
        <input 
            id="imgInput"
            type="file" 
            accept="image/*"
            @change="handleImageUpload"
            class="text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
        />
    </div>
    <div v-if="currentImage" class="mt-2 p-1 border border-dashed rounded bg-gray-50 inline-block">
        <span class="text-xs text-gray-400 block mb-1">å³å°†å‘é€:</span>
        <img :src="currentImage" class="h-16 object-cover rounded">
    </div>
</div>
            </div>

            <div class="mb-2 bg-gray-50 p-2 rounded border">
                 <label class="flex items-center cursor-pointer">
                 <input type="checkbox" v-model="showAvatar" class="w-5 h-5 text-blue-600">
                 <span class="ml-2 font-bold text-gray-700 text-sm">æ˜¾ç¤ºå¤´åƒ</span>
                 </label>
            </div>
    <input v-model="threadTitle" class="w-full border p-1 rounded text-sm font-bold" placeholder="å¸–å­æ ‡é¢˜">

    <div class="flex items-center mt-2 text-sm text-gray-600">
         <span class="mr-2">ğŸ‘€ æµè§ˆé‡:</span>
         <input v-model="viewCount" type="number" class="border p-1 rounded w-24">
    </div>
            <button @click="addPost" 
                :class="insertIndex !== -1 ? 'bg-purple-600 hover:bg-purple-700' : 'bg-blue-600 hover:bg-blue-700'"
                class="text-white py-2 rounded shadow transition-colors w-full mb-2">
                {{ insertIndex !== -1 ? 'âœ¨ ç¡®è®¤æ’å…¥' : 'å‘é€ (è¿½åŠ æ¥¼å±‚)' }}
            </button>
            
            <hr>
            
            <button @click="exportImage" class="bg-red-600 text-white py-2 rounded hover:bg-red-700 shadow w-full mt-2">
                ğŸ“¸ ç”Ÿæˆé•¿æˆªå›¾
            </button>
        </div>

        <div class="w-2/3 overflow-auto bg-gray-200 p-5">
            <div id="capture-area" class="preview-area min-h-[600px] w-full max-w-[600px] mx-auto shadow-lg text-sm text-gray-800 font-sans relative">
            <div class="bg-[#4C281B] text-white p-2 text-xs font-sans border-b border-gray-200">
    <span>{{ forumName }}</span> 
    &gt; 
    <span>{{ subForum }}</span>
</div>

<div class="bg-white m-4 p-4 rounded-lg shadow-sm border border-gray-200">
    <h1 class="text-xl font-bold text-gray-800 mb-3 tracking-wide">
        {{ threadTitle }}
    </h1>
    
    <div class="flex items-center text-xs text-gray-500 gap-4">
        <div class="flex items-center gap-1">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
            <span>æµè§ˆ: {{ viewCount }}</span>
        </div>

        <div class="flex items-center gap-1">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
            <span>å›å¤: {{ posts.length - 1 }}</span>
        </div>
    </div>
</div>
              <div v-for="(post, index) in posts" :key="index" class="post-card p-4 flex gap-3 relative group">
    
    <div v-if="showAvatar" class="w-12 flex-shrink-0 text-center">
        <div class="w-10 h-10 bg-gray-200 rounded-sm mx-auto mb-1 overflow-hidden border-2 border-gray-300">
          <img v-if="post.role === 'LZ'" src="https://api.dicebear.com/7.x/pixel-art/svg?seed=lz" class="w-full h-full" />
          <img v-else :src="'https://api.dicebear.com/7.x/pixel-art/svg?seed=' + post.id" class="w-full h-full" />
        </div>
    </div>
    
    <div class="flex-1">
        <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span class="font-bold text-[#562214]">
    {{ post.id }}
    <span v-if="post.role === 'LZ'" class="ml-1 bg-blue-100 text-blue-800 text-[10px] px-1.5 py-0.5 rounded border border-blue-200 align-middle font-normal">
        æ¥¼ä¸»
    </span>
</span>
            <span>{{ post.time }} | {{ index }}L</span>
        </div>
        
        <div v-if="post.content" class="leading-relaxed whitespace-pre-wrap">{{ post.content }}</div>

        <div v-if="post.image" class="mt-3">
            <img :src="post.image" class="max-w-full max-h-[500px] rounded border border-gray-200 mx-auto shadow-sm" />
        </div>
    </div>
    <div class="action-buttons absolute right-2 top-2 flex gap-1" data-html2canvas-ignore="true">
        <button @click="prepareInsert(index)" title="åœ¨æ­¤æ¥¼åæ’å…¥" class="bg-purple-100 text-purple-600 hover:bg-purple-200 p-1 rounded text-xs">â•</button>
        <button @click="deletePost(index)" title="åˆ é™¤æ­¤æ¥¼" class="bg-red-100 text-red-600 hover:bg-red-200 p-1 rounded text-xs">ğŸ—‘ï¸</button>
    </div>
</div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref } = Vue;

        createApp({
            setup() {
                // --- æ•°æ®å®šä¹‰ ---
                const threadTitle = ref("æ±‚åŠ©ï¼æˆ‘çš„å®¤å‹å¥½åƒæ˜¯ä¸ªæ€æ‰‹...");
                const viewCount = ref(5832); // æ–°å¢ï¼šæµè§ˆé‡é»˜è®¤å€¼
                const forumName = ref("NGAç©å®¶ç¤¾åŒº");
                const subForum = ref("æ™´é£æ‘");
                const currentImage = ref(null);
                const currentRole = ref("LZ");
                const currentId = ref("æ— åŠ©çš„æ¥¼ä¸»");
                const content = ref("");
                const showAvatar = ref(true);
                const insertIndex = ref(-1); // -1 è¡¨ç¤ºæ­£å¸¸è¿½åŠ ï¼Œ>=0 è¡¨ç¤ºåœ¨è¯¥indexåæ’å…¥
                const handleImageUpload = (event) => {
                  const file = event.target.files[0];
                  if (file) {
                 // æŠŠæ–‡ä»¶å˜æˆä¸€ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨æ˜¾ç¤ºçš„ä¸´æ—¶é“¾æ¥
                  currentImage.value = URL.createObjectURL(file);
                    }
                };
                const posts = ref([
                    { role: 'LZ', id: 'æ— åŠ©çš„æ¥¼ä¸»', content: 'å¦‚é¢˜ï¼Œæ˜¨å¤©åŠå¤œå¬åˆ°ä»–åœ¨ç£¨åˆ€...', time: '2023-10-25 10:00' }
                ]);

                const presets = ref([
                    { name: 'æ¥¼ä¸»æœ¬äºº', role: 'LZ', id: 'æ— åŠ©çš„æ¥¼ä¸»' },
                    { name: 'è·¯äººç”²', role: 'è·¯äºº', id: 'è·¯äººç”²' },
                    { name: 'æ ç²¾', role: 'è·¯äºº', id: 'æš´èºè€å“¥' }
                ]);
                const selectedPreset = ref("");          
                const newPresetName = ref(""); 
                const newPresetId = ref("");   

                // --- æ–¹æ³•å®šä¹‰ ---

                // 1. åˆ é™¤æ¥¼å±‚
                const deletePost = (index) => {
                    if(confirm(`ç¡®å®šè¦åˆ é™¤ ${index} æ¥¼å—ï¼Ÿ`)) {
                        posts.value.splice(index, 1);
                    }
                };

                // 2. å‡†å¤‡æ’å…¥ (ç‚¹å‡»å³ä¾§åŠ å·è§¦å‘)
                const prepareInsert = (index) => {
                    insertIndex.value = index;
                    // è´´å¿ƒæç¤ºï¼šè‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
                    document.querySelector('textarea').focus();
                };

                // 3. å–æ¶ˆæ’å…¥
                const cancelInsert = () => {
                    insertIndex.value = -1;
                };
                
                // 4. å‘é€/æ’å…¥æ ¸å¿ƒé€»è¾‘
                const addPost = () => {
                   if (!content.value && !currentImage.value) return;

                    const newPost = {
                        role: currentRole.value,
                       // æ”¹æˆè¿™æ ·ï¼šä¼˜å…ˆè¯»å–è¾“å…¥æ¡†é‡Œçš„ currentIdï¼Œåªæœ‰å½“è¾“å…¥æ¡†æ˜¯ç©ºçš„æ—¶å€™ï¼Œæ‰ç»™ä¸ªé»˜è®¤å€¼
                        id: currentId.value || (currentRole.value === 'LZ' ? 'æ¥¼ä¸»' : 'è·¯äººç”²'),
                        content: content.value,
                        image: currentImage.value,
                        time: new Date().toLocaleTimeString()
                    };

                    if (insertIndex.value === -1) {
                        // æ­£å¸¸è¿½åŠ åˆ°æœ€å
                        posts.value.push(newPost);
                    } else {
                        // åœ¨æŒ‡å®šä½ç½®åé¢æ’å…¥
                        posts.value.splice(insertIndex.value + 1, 0, newPost);
                        insertIndex.value = -1; // æ’å…¥å®Œå¤ä½
                    }
                    
                    content.value = "";
                    currentImage.value = null;
                    document.getElementById('imgInput').value = '';
                    if (currentRole.value === 'è·¯äºº') {
                        // ç®€å•çš„éšæœºIDé˜²é‡å¤
                    }
                };

                const applyPreset = () => {
                    const target = presets.value.find(p => p.name === selectedPreset.value);
                    if (target) {
                        currentRole.value = target.role;
                        currentId.value = target.id;    
                    }
                };

                const addCustomPreset = () => {
                    if (!newPresetName.value || !newPresetId.value) {
                        alert("è¯·å¡«å†™è§’è‰²å¤‡æ³¨å’ŒIDï¼");
                        return;
                    }
                    presets.value.push({
                        name: newPresetName.value,
                        role: 'è·¯äºº',
                        id: newPresetId.value
                    });
                    selectedPreset.value = newPresetName.value;
                    applyPreset(); 
                    newPresetName.value = "";
                    newPresetId.value = "";
                };

                const exportImage = () => {
                    html2canvas(document.getElementById("capture-area"), {
                        // ç¡®ä¿å¿½ç•¥å¸¦æœ‰ data-html2canvas-ignore çš„å…ƒç´ 
                        ignoreElements: (element) => {
                            return element.getAttribute('data-html2canvas-ignore') === 'true';
                        }
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = 'forum_screenshot.png';
                        link.href = canvas.toDataURL();
                        link.click();
                    });
                };

                return {
                    threadTitle, forumName, subForum, viewCount,currentImage,handleImageUpload,
                    currentRole, currentId, content, posts, showAvatar,
                    presets, selectedPreset, newPresetName, newPresetId, insertIndex,
                    addPost, exportImage, applyPreset, addCustomPreset, 
                    deletePost, prepareInsert, cancelInsert // æ–°å¢æ–¹æ³•
                };
            }
        }).mount('#app');
    </script>
</body>
</html>